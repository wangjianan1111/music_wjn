<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.bjfu.notation_jh.dao.MusicWorkMapper">
    <resultMap id="BaseResultMap" type="com.bjfu.notation_jh.model.MusicWork">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Tue Jan 15 11:05:12 CST 2019.
        -->
        <id column="id" property="id" jdbcType="BIGINT"/>
        <id column="uid" property="uid" jdbcType="VARCHAR"/>
        <id column="notation_id" property="notationId" jdbcType="BIGINT"/>
        <result column="singer_id" property="singerId" jdbcType="BIGINT"/>
        <result column="remark" property="remark" jdbcType="SMALLINT"/>
        <result column="music_download_url" property="musicDownloadUrl" jdbcType="VARCHAR"/>
        <result column="notation_pic" property="notationPic" jdbcType="VARCHAR"/>
        <result column="music_name" property="musicName" jdbcType="VARCHAR"/>
        <result column="music_id" property="musicId" jdbcType="VARCHAR"/>
    </resultMap>
    <sql id="Base_Column_List">
        id, uid, notation_id, singer_id, remark, music_download_url, notation_pic,music_name,music_id
    </sql>

    <!--分页查询用户作品-->
    <select id="queryWorksByPage" resultMap="BaseResultMap">
        SELECT
        <include refid="Base_Column_List" />
        FROM t_music
        where uid = #{uid} and remark = #{remark}
        <if test="musicName!= null and musicName!=''">
            and music_name like concat(concat('%',#{musicName}),'%')
        </if>
        ORDER BY id asc
        LIMIT #{pageNum},#{pageSize}
    </select>

    <!--保存用户收藏简谱-->
    <insert id="saveCollectionNotation" parameterType="com.bjfu.notation_jh.model.MusicWork">
        insert into t_music (uid, notation_id,
                            singer_id, remark, music_download_url,
                            notation_pic,music_name,music_id)
        values (#{uid}, #{notationId},
        #{singerId}, #{remark}, #{musicDownloadUrl},#{notationPic},#{musicName},#{musicId})
    </insert>

    <!--根据条件查询简谱-->
    <select id="queryMusicCount" parameterType="com.bjfu.notation_jh.common.request.WorkSearchRequest" resultType="java.lang.Integer">
        SELECT
        count(*)
        FROM t_music
        <where> 1=1
            <if test="sr.uid!= null and sr.uid!=''">
                and uid=#{sr.uid}
            </if>
            <if test="sr.remark!= null and sr.remark!=''">
                and remark=#{sr.remark}
            </if>
            <if test="sr.musicName!= null and sr.musicName!=''">
                and music_name like concat(concat('%',#{sr.musicName}),'%')
            </if>
        </where>
        ORDER BY id asc
    </select>

    <!-- 删除作品 -->
    <delete id="deleteMusic" parameterType="java.lang.Long">
        delete from t_music where
            id=#{id}
    </delete>

</mapper>





















